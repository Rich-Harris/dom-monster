<html>
<head>
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="link">
  You're looking at a vanilla DOM<br>
  version of <a href="https://dbmonster.firebaseapp.com/">DBMonster</a>.<br>
  <a class="center" href="https://github.com/rich-harris/dom-monster">See it on GitHub</a>
</div>

<div id="body">
  <table class="table table-striped latest-data">
    <tbody></tbody>
  </table>
</div>

<script src="underscore-min.js"></script>
<script src="junkola-copied-from-ember.js"></script>

<script src="https://cdn.rawgit.com/paulirish/memory-stats.js/master/memory-stats.js"></script>
<script>
var stats = new MemoryStats();
stats.domElement.style.position = 'fixed';
stats.domElement.style.right        = '0px';
stats.domElement.style.bottom       = '0px';
document.body.appendChild( stats.domElement );
requestAnimationFrame(function rAFloop(){
    stats.update();
    requestAnimationFrame(rAFloop);
});
</script>

<script type="text/javascript">
  var ROWS = 100;
  var TIMEOUT = 0;

  (function () {
    function Row ( db ) {
      this.dom = {};
      this.dom.el = document.createElement( 'tr' );

      this.dom.name = this.dom.el.appendChild( document.createElement( 'td' ) );
      this.dom.name.className = 'dbname';

      this.dom.count = this.dom.el.appendChild( document.createElement( 'td' ) );
      this.dom.count.className = 'query-count';

      this.dom.countSpan = this.dom.count.appendChild( document.createElement( 'span' ) );

      this.cells = [];
      var cell;
      for ( var i = 0; i < 5; i += 1 ) {
        cell = {
          dom: {
            el: this.dom.el.appendChild( document.createElement( 'td' ) )
          }
        };

        cell.dom.elapsed = cell.dom.el.appendChild( document.createTextNode( '' ) );

        cell.dom.popover = cell.dom.el.appendChild( document.createElement( 'div' ) );
        cell.dom.popover.className = 'popover left';

        cell.dom.popoverContent = cell.dom.popover.appendChild( document.createElement( 'div' ) );
        cell.dom.popoverContent.className = 'popover-content';

        cell.dom.popoverArrow = cell.dom.popover.appendChild( document.createElement( 'div' ) );
        cell.dom.popoverArrow.className = 'arrow';

        this.cells.push( cell );
      }
    };

    Row.prototype.update = function ( db ) {
      if ( db.name !== this.name ) {
        this.dom.name.textContent = this.name = db.name;
      }

      if ( db.countClassName !== this.countClassName ) {
        this.dom.countSpan.className = this.countClassName = db.countClassName;
      }

      if ( db.queries.length !== this.numQueries ) {
        this.dom.countSpan.textContent = this.numQueries = db.queries.length;
      }

      var cells = this.cells;
      var cell, query;

      for ( var i = 0; i < 5; i += 1 ) {
        cell = cells[i];
        query = db.topFiveQueries[i];

        if ( query.className !== cell.className ) {
          cell.dom.el.className = cell.className = 'Query ' + query.className;
        }

        if ( query.elapsed !== cell.elapsed ) {
          cell.dom.elapsed.data = cell.elapsed = query.elapsed;
        }

        if ( query.query !== cell.query ) {
          cell.dom.popoverContent.textContent = cell.query = query.query;
        }
      }
    };

    var tbody = document.querySelector( 'tbody' );

    var rows = getDatabases().map( function ( db ) {
      var row = new Row();

      row.update( db );
      tbody.appendChild( row.dom.el );

      return row;
    });

    function redraw() {
      getDatabases().forEach( function ( db, i ) {
        rows[i].update( db );
      });
      setTimeout(redraw, TIMEOUT);
    }
    redraw();
  }());
</script>

</body>
</html>
